---
layout: post
title:  "机器学习初探二"
date:   2025-04-06
desc: "Java 源码 机器学习"
keywords: "Java 源码 机器学习"
categories: [Java]
tags: [Java]
icon: icon-html
---

下面我们实际来处理一个案例<p>心脏病预测</p><br/>
```sh
#年龄：连续值
#性别：0-女，1-男
#胸痛类型：1-典型心绞痛，2-非典型心绞痛，3-非心绞痛，4-无症状
#静息血压：连续值，单位mmHg
#胆固醇：连续值，单位mg/dl
#空腹血糖：1-大于120mg/dl，2-小于等于120mg/dl
#静息心电图结果：0-正常，1-ST-T异常，2-可能左心室肥大
#最大心率：连续值
#运动性心绞痛：1-有，2-无
#运动后的ST下降：连续值
#峰值ST段的斜率：1-向上，2-水平，3-向下
#主血管数量：0到3
#地中海贫血：一种先天性贫血，3-正常，6-固定缺陷，7-可逆缺陷
#是否患有心脏病：标签，0-否，1-是

import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler, OneHotEncoder
from sklearn.compose import ColumnTransformer
from sklearn.neighbors import KNeighborsClassifier
import joblib

heart_disease = pd.read_csv("heart_disease.csv")

heart_disease.dropna()
heart_disease.info()
heart_disease.head()

#划分数据集
x = heart_disease.drop("是否患有心脏病", axis=1)
#提取标签
y = heart_disease["是否患有心脏病"]
# 将数据集按7:3划分为训练数据与测试数据
x_train, x_test, y_train, y_test = train_test_split(x, y, test_size=0.3, random_state=100)

# 数值型特征
numerical_features = ["年龄", "静息血压", "胆固醇", "最大心率", "运动后的ST下降", "主血管数量"]
# 类别型特征
categorical_features = ["胸痛类型", "静息心电图结果", "峰值ST段的斜率", "地中海贫血"]
# 二元特征
binary_features = ["性别", "空腹血糖", "运动性心绞痛"]

preprocessor = ColumnTransformer(
    transformers=[
         # 对数值型特征进行标准化
         ("num", StandardScaler(), numerical_features),
         # 对类别型特征进行独热编码，使用drop="first"避免多重共线性
         ("cat", OneHotEncoder(drop="first"), categorical_features),
         # 二元特征不进行处理
         ("binary", "passthrough", binary_features),]
)

# 执行特征转换
x_train = preprocessor.fit_transform(x_train) # 计算训练集的统计信息并进行转换
x_test = preprocessor.transform(x_test) # 使用训练集计算的信息对测试集进行转换


# 使用K近邻分类模型，K=3
knn = KNeighborsClassifier(n_neighbors=3)
# 模型训练
knn.fit(x_train, y_train)
# 模型评估，计算准确率
score = knn.score(x_test, y_test)
print(score)

joblib.dump(knn, "knn_heart_disease")
# 加载模型
knn_loaded = joblib.load("knn_heart_disease")
# 预测
y_pred = knn_loaded.predict(x_test[10:11])
# 打印真实值与预测值
print(y_test.iloc[10], y_pred)

```

